<html>
<head>
	<!--Including links to tabletop JS/Jquery/and leaflet -->
	<script src="tabletop/tabletop.js"></script>
	<script src="assets/IowaCounties.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.css" />
		<!--[if lte IE 8]>
    	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.ie.css" />
		<![endif]-->
	<script src="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.js"></script>
	<link href="styles/sirenstyle.css" rel="stylesheet" />
</head>



<body>

<div id='map'>
	<div id='info'>
		<h3 id='title'>Siren Information</h3>
		<p id='stats'>Hover over a circle</p>
	</div>
</div>

<p id = 'location'>None</div>

<script type="text/javascript">

$(document).ready(function() { init() });
  var finished_data = {};


  var public_spreadsheet_url = 'https://docs.google.com/spreadsheet/pub?key=0Ap8xpet401Q-dHlsN3ZGMm1WdkZyTmsxZkJwdHlBZ1E&output=sharing';

  function init() {
    Tabletop.init( { key: public_spreadsheet_url,
                     callback: showInfo,
                     simpleSheet: true } )
  }

  function showInfo(data, tabletop) {
    finished_data = data;

    var map = L.map('map').setView([41.85755,-91.52572], 10);

		L.tileLayer('http://{s}.tile.cloudmade.com/0a15ccd992b040678a3121d71ee92ace/44094/256/{z}/{x}/{y}.png', {
			key:'...',
			maxZoom: 18,
			attribution:'Web design and programming by Max Freund/ The Gazette'
		}).addTo(map);

	var johnson = L.polygon(johnsonCounty,{ color: 'gray', fillColor: '#3182BD', fillOpacity: .1, weight: 1}).addTo(map);
	var linn = L.polygon(linnCounty,{ color: 'gray', fillColor: '#3182BD', fillOpacity: .1, weight: 1}).addTo(map);
	var blackhawk = L.polygon(blackhawkCounty,{ color: 'gray', fillColor: '#3182BD', fillOpacity: .1, weight: 1}).addTo(map);




  	var sirenIcon = L.icon({
				iconUrl: 'assets/dot.png',
				shadowUrl: 'assets/dot.png',

				iconSize:     [6, 6],
				shadowSize:   [6, 6],
				iconAnchor:   [3, 3],
				shadowAnchor: [3, 3],
				popupAnchor:  [0, 0],
				});
  	function onMouseIn(e){
  		var layer = e.target;
  		$('#stats').html('Location: ' + layer['options']['location'] + '<br />' + 'Radius: ' + layer['options']['radius'] + ' feet' + '<br />' + 'Type: ' + layer['options']['type']);
		layer.setStyle({
        	weight: 5,
        	color: '#666',
        	fillColor: '#E6550D',
        	fillOpacity: 0.8
    	});
  	}

  	function onMouseOut(e){
  		var layer = e.target;
  		$('#stats').html('Hover over a circle');
		layer.setStyle({
        	weight: 2,
        	color: 'gray',
        	fillOpacity: 0.4,
        	fillColor: '#FDAE6B'
        });
  	}


	for (var i=0;i<finished_data.length;i++){
		var circle = L.circle([finished_data[i]['lat'], finished_data[i]['lon']], (.3048 * finished_data[i]['radius']), {
			color: 'gray',
			fillColor: '#FDAE6B',
			fillOpacity: 0.4,
			weight: 2,
			location: finished_data[i]['address'],
			radius: finished_data[i]['radius'],
			type: finished_data[i]['type']
		}).addTo(map);
		circle.on('mouseover', onMouseIn);
		circle.on('mouseout', onMouseOut);
		var marker = L.marker([finished_data[i]['lat'], finished_data[i]['lon']], {icon:sirenIcon}).addTo(map);
	}


	

}


</script>

</body>



</html>